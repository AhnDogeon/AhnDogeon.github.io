<!DOCTYPE html>
<html lang="en">
    <head>
	<meta name="generator" content="Hugo 0.101.0" />
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>DG&#39;s Blog</title><meta name="Description" content="About Kid"><meta property="og:title" content="DG&#39;s Blog" />
<meta property="og:description" content="About Kid" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ahndogeon.github.io/" /><meta property="og:image" content="https://ahndogeon.github.io/images/profile3.png"/><meta property="og:site_name" content="My cool site" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ahndogeon.github.io/images/profile3.png"/>

<meta name="twitter:title" content="DG&#39;s Blog"/>
<meta name="twitter:description" content="About Kid"/>
<meta name="application-name" content="kid">
<meta name="apple-mobile-web-app-title" content="kid"><meta name="theme-color" content="#DB6B97"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/favicon.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://ahndogeon.github.io/" /><link rel="alternate" href="/index.xml" type="application/rss+xml" title="DG&#39;s Blog">
    <link rel="feed" href="/index.xml" type="application/rss+xml" title="DG&#39;s Blog"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "WebSite",
        "url": "https:\/\/ahndogeon.github.io\/","inLanguage": "en","author": {
                "@type": "Person",
                "name": "Dogeon Ahn"
            },"description": "About Kid","image": "https:\/\/ahndogeon.github.io\/images\/profile3.png","thumbnailUrl": "https:\/\/ahndogeon.github.io\/images\/profile3.png","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","name": "DG's Blog"
    }
    </script></head>
    <body data-header-desktop="auto" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('light' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'light' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1770372016619989"
     crossorigin="anonymous"></script>
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="DG&#39;s Blog"><span class="header-title-pre"><span style='color: Mediumslateblue;'><</span></span><span id="id-1" class="typeit"></span><span class="header-title-post"><span style='color: Mediumslateblue;'>/></span></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="https://github.com/ahndogeon/blog" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="DG&#39;s Blog"><span class="header-title-pre"><span style='color: Mediumslateblue;'><</span></span><span id="id-2" class="typeit"></span><span class="header-title-post"><span style='color: Mediumslateblue;'>/></span></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="https://github.com/ahndogeon/blog" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="page home" data-home="posts"><div class="home-profile"><div class="home-avatar"><a href="/posts/" title="Posts"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/profile.png"
        data-srcset="/images/profile.png, /images/profile.png 1.5x, /images/profile.png 2x"
        data-sizes="auto"
        alt="/images/profile.png"
        title="/images/profile.png" width="460" height="460" /></a></div><h1 class="home-title">Dogeon</h1><div class="home-subtitle"><div id="id-3" class="typeit"></div></div><div class="links"><a href="https://github.com/ahndogeon" title="GitHub" target="_blank" rel="noopener noreffer me"><i class="fab fa-github fa-fw" aria-hidden="true"></i></a><a href="mailto:ahndogeon@naver.com" title="Email" rel="me"><i class="far fa-envelope fa-fw" aria-hidden="true"></i></a><a href="/index.xml" title="RSS" target="_blank" rel="noopener noreffer me"><i class="fas fa-rss fa-fw" aria-hidden="true"></i></a></div></div>
<article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/make_api2/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/fast_api_image.png"
        data-srcset="/images/fast_api_image.png, /images/fast_api_image.png 1.5x, /images/fast_api_image.png 2x"
        data-sizes="auto"
        alt="/images/fast_api_image.png"
        title="This article explain how to make api server with FastAPI" width="1023" height="369" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/make_api2/">API 서버 구축기 2탄</a>
    </h1><div class="post-meta"><span class="post-author"><a href="https://github.com/ahndogeon" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>AhnDogeon</a></span>&nbsp;<span class="post-publish">published on <time datetime="2022-08-15">2022-08-15</time></span>&nbsp;<span class="post-category">included in <a href="/categories/dev/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>dev</a></span></div><div class="content"><blockquote>
<p>FastAPI로 api 서버를 개발하고, 배포해보자 2탄</p>
</blockquote></div><div class="post-footer">
        <a href="/make_api2/">Read More</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/api/">API</a>,&nbsp;<a href="/tags/server/">Server</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/make_api/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/fast_api_image.png"
        data-srcset="/images/fast_api_image.png, /images/fast_api_image.png 1.5x, /images/fast_api_image.png 2x"
        data-sizes="auto"
        alt="/images/fast_api_image.png"
        title="This article explain how to make api server with FastAPI" width="1023" height="369" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/make_api/">API 서버 구축기 1탄</a>
    </h1><div class="post-meta"><span class="post-author"><a href="https://github.com/ahndogeon" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>AhnDogeon</a></span>&nbsp;<span class="post-publish">published on <time datetime="2022-08-04">2022-08-04</time></span>&nbsp;<span class="post-category">included in <a href="/categories/dev/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>dev</a></span></div><div class="content">FastAPI로 api 서버를 개발하고, 배포해보자
2021년 상반기에 만들었던 로블록스 게임과 연계해서 이벤트를 해보자는 협업 요청이 들어왔다. 외부앱에서 들어오는 요청에 대한 응답을 해주는 서버 개발이 필요했고, 오픈 일정이 매우 촉박했기에 FastAPI로 빠르게 개발하는 것이 좋다는 판단을 했다.
이번 장에서는 FastAPI 개발 내용을 정리하고, DB연동과 서버 배포에 대한 내용을 차례로 정리할 계획이다.
당연하게도 사내 프로젝트인만큼 블로그에서는 상세한 구축법, 코드, 아키텍처를 제외한, 트러블슈팅 내용, 개발 고민, 과정, 간단 코드 위주로 포스팅을 하겠다.
서버 스펙 명세 버전관리시스템 : Git - GitLab API 설계 원칙 : REST API 직렬화 포맷 : JSON 사용자 인증 : Authorization 헤더 인증 스키마 : Bearer + token (Lambda Authorizer 사용) 언어 + 웹 프레임워크 : Python + FastAPI 컴퓨팅 서비스 : AWS Lambda (ap-northeast-2, seoul) 배포 라이브러리 : Mangum (zappa는 FastAPI 지원안함) 게이트웨이 : AWS API Gateway 데이터베이스 : AWS RDS PostgreSQL(엔진) + sqlalchemy(orm) &raquo;&gt; mysql + sqlalchemy(orm) 개발 초기 내부망이 아닌 외부망에서 진행 계획이었던 프로젝트라, postgre를 사용하였는데, 개발 도중 내부망으로 들여와야 했다. 1. 환경설정 FastAPI 설치 1 2 $ pip install fastapi $ pip install uvicorn main.py 작성 mangum 이나, uvicorn 등 기타 필요한 사항들을 상단에 import 시켜줘야 한다. 1 2 3 4 5 6 7 8 9 10 app = FastAPI( title=&#34;&lt;server name&gt;&#34;, description=&#34;&lt;server description&gt;&#34;, default_response_class=JSONResponse, ) # 라우터 정의 # 라우터 디렉토리를 두 개로 나누어줬다. app.include_router(index.router, prefix=&#34;/v1&#34;) app.include_router(evntcode.router, prefix=&#34;/v1&#34;) 2. API 코드 작성 라우터를 설정해주면, 남은건 API를 만들 시간이다. 서버의 주요기능을 작성하는만큼 미리 명세를 잘 짜두고, 기본적인 것이지만 어떤 인자를 써야할지, GET 요청인지, POST 요청인지 등등을 정리해두고 개발하길 추천한다.
가장 먼저, 현재 시간 리턴하는 서버 상태 체크용 GET요청 함수를 만들어줬다.
routes/index.py
1 2 3 4 5 6 7 8 9 @router.get(&#34;&#34;, include_in_schema=False) async def index(): &#34;&#34;&#34; 상태 체크용 API :return: &#34;&#34;&#34; current_time = datetime.utcnow() return Response(f&#34;server time: {current_time.strftime(&#39;%Y.%m.%d %H:%M:%S&#39;)})&#34;) 이후는 명세에 필요한 POST 요청을 하나하나 만들어줘야 하는데, POST인만큼 DB모델링과 schema를 만들어줘야 했다. 해당 경로로 가자
app/db/models.py
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 from sqlalchemy import &lt;사용할 데이터 타입&gt; from sqlalchemy.orm import relationship from .conn import Base class ForExample(Base): &#34;&#34;&#34; 포스팅을 위한 예시 모델링 클래스다. &#34;&#34;&#34; __tablename__ = &#39;&lt;your table name&gt;&#39; # # ========================================================================================= # # 1. 사용할 칼럼들을 모델링 # # ========================================================================================= evntcode = Column(Text, primary_key=True, nullable=False, unique=True) cost = Column(Integer, nullable=False) 간단하게 모델링 예시를 들어봤다. 클래스 안에 칼럼들을 쭉 써주면 되는데, 각 칼럼들에 맞게 타입을 지정해주고, 필요 인자들을 넣어주면 된다. 추후에 적을 것이지만, 내부망으로 들여오는 작업을 진행하면서 이 DB들을 내부망에 맞게 싹 바꿔줘야 했는데, 굉장히 난해한 작업이었다. 칼럼명부터 한글이다. 다시 API 코드 작성으로 돌아가자. 아래는 간략한 POST 코드다.
routes/evntcode.py
1 2 3 4 5 6 7 8 9 10 11 12 13 @router.post(&#39;/&lt;경로 이름짓기가 은근 힘들다.&gt;&#39;) async def &lt;함수이름도 마찬가지&gt;(request: Request, body: &lt;bodyname&gt;, credentials: HTTPAuthorizationCredentials = Security(security), db: Session = Depends(get_db)): &#34;&#34;&#34; POST 요청 예시 \n &#34;&#34;&#34; # Authrization Check (Bearer Token) # token 인증 외에도 TLS, 보안솔루션 설치 등의 절차가 꼭 필요하다 # DB update result = crud.DB_UpdateFunc(db, body.code) return result 3. 정리하며 이런 식으로 명세에 맞게 설계한 API들을 쭉 개발해주면 된다. 개발 과정에서 명세 또한 계속해서 바뀌고, 그 과정에서 코드를 수정하며, 조금 더 효율적으로 바꿀 수 있지 않을까?</div><div class="post-footer">
        <a href="/make_api/">Read More</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/api/">API</a>,&nbsp;<a href="/tags/server/">Server</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/make_blog/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/make_blog.jpeg"
        data-srcset="/images/make_blog.jpeg, /images/make_blog.jpeg 1.5x, /images/make_blog.jpeg 2x"
        data-sizes="auto"
        alt="/images/make_blog.jpeg"
        title="This article shows the basic Markdown syntax and format." width="259" height="194" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/make_blog/">블로그를 만들어보자</a>
    </h1><div class="post-meta"><span class="post-author"><a href="https://github.com/ahndogeon" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>AhnDogeon</a></span>&nbsp;<span class="post-publish">published on <time datetime="2022-07-31">2022-07-31</time></span>&nbsp;<span class="post-category">included in <a href="/categories/dev/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>dev</a></span></div><div class="content"><blockquote>
<p><code>Hugo</code>를 학습하고 나만의 블로그를 만들어 배포해보자.</p>
</blockquote></div><div class="post-footer">
        <a href="/make_blog/">Read More</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/web/">Web</a>,&nbsp;<a href="/tags/hugo/">HUGO</a></div></div>
</article><article class="single summary" itemscope itemtype="http://schema.org/Article"><div class="featured-image-preview">
            <a href="/initial_post/"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/first_post.png"
        data-srcset="/images/first_post.png, /images/first_post.png 1.5x, /images/first_post.png 2x"
        data-sizes="auto"
        alt="/images/first_post.png"
        title="This article shows the basic Markdown syntax and format." width="700" height="332" /></a>
        </div><h1 class="single-title" itemprop="name headline">
        <a href="/initial_post/">Initial Post</a>
    </h1><div class="post-meta"><span class="post-author"><a href="https://github.com/ahndogeon" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>AhnDogeon</a></span>&nbsp;<span class="post-publish">published on <time datetime="2022-07-28">2022-07-28</time></span>&nbsp;<span class="post-category">included in <a href="/categories/markdown/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Markdown</a></span></div><div class="content"><blockquote>
<p>This article offers a sample of basic Markdown syntax that can be used in Hugo content files.</p>
</blockquote></div><div class="post-footer">
        <a href="/initial_post/">Read More</a><div class="post-tags">
                <i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/markdown/">Markdown</a>,&nbsp;<a href="/tags/html/">HTML</a></div></div>
</article></div></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/ahndogeon" target="_blank">Dogeon Ahn</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"data":{"id-1":" DG's Blog ","id-2":" DG's Blog ","id-3":"I am Developer 🐋"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"id-1":["id-1"],"id-2":["id-2"],"id-3":["id-3"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
